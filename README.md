# ChaosCore


### What is ChaosCore?

ChaosCore is a Speculative Out-of-Order RV32G core aimed at exploring the tradeoffs resulting from various security and performance considerations. ChaosCore is also designed to run out of the box and includes a slew of benchmarks and tests for demonstration and analysis. 

### Docker

You may have noticed the existence of a Dockerfile. This is because this entire repository is designed to be packaged into a system that can be run in a containerized environment deployable on any system. See [Running ChaosCore](#running-chaoscore) for detailed information on running ChaosCore. 

### Directories

```cocotb``` contains all hardware tests. In this folder exist two sub-dirs. ``` functional_tests ``` contains basic tests for various parts of the design. These
tests do not have any particular structure. ```UVM``` tests contain more rigorous tests for the various modules. System level tests, for instance, would exist there. These tests use PyUVM + Cocotb for the test 'front-end' and Verilator V5.006 for the 'back-end'.

```doc``` contains important details about various aspects of the design. It includes, for instance, details about the architecture as well as the naming conventions used throughout the various design files. It also includes some information about test strategies used to verify the design. 

```hw``` contains the design files. The ```chisel``` sub-folder contains the chisel code. The ```verilog``` sub-folder contains both the auto-generated verilog files as well as custom (and possibly recycled) hand written verilog files. 

```py``` contains related python files, libraries, models, and utils used for both the design and verification. 


# Requirements 
1) Verilator 5.024
2) Cocotb 1.8.1
3) riscv gcc 
3) Spike


# Strong Suggestions

1) Set vscode to ignore everything in .gitignore (way too many junk files are generated by all the tools for the repo to be managable without hiding some)


# Improvements Needed for ChaosCore V2

1) Before making any updates to the core, Core Mark MUST be run. Resulting freq and area must be documented.
2) Each Major iteration MUST be placed in its own branch for cross referencing,

0) A bunch of performance counters (mispreds, hits, misses, etc...)
1) A non naive LSQ/memory subsystem
2) A 2+ at a time commit ROB
3) A banked cache
4) Age based + real time RS scheduling for instructions
5) Improved branch prediction?
    * TAGE, etc
    * Quick BP and slow BP in paralell
6) Resolving mispredictions out of order (use of a BOB instead of a FTQ)
7) Execution Bypass Network(s)
8) Potentially too many queues in RS
9) Cache fetches across lines
10) Clear ROB and pipeline as soon as branch is resolved instead of waiting for FTQ+commit.
11) SIMD? 

# General TODOs

1) Need virtual memory

### Running ChaosCore

#### Tests
TODO
#### Pre-Packaged Benchmarks
TODO
#### Custom C
TODO




# Installing RISCV GNU:

Run the following commands (6+ GB download. takes ~10-20 minutes):
(I dont think you actually need a recursive clone)

```
sudo apt-get install autoconf automake autotools-dev curl python3 python3-pip libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev ninja-build git cmake libglib2.0-dev libslirp-dev

#git clone https://github.com/riscv-collab/riscv-gnu-toolchain --recurse-submodules
git clone https://github.com/riscv-collab/riscv-gnu-toolchain
cd riscv-gnu-toolchain
#./configure --prefix=/opt/riscv --with-arch=rv32gc_zicsr_zifencei --with-abi=ilp32  # build the "complete" RISC-V RV32 config with privilages
./configure --prefix=/opt/riscv --with-arch=rv32im_zicsr_zifencei --with-abi=ilp32 --enable-multilib

sudo make -j12
```

then add 

```
export PATH="$PATH:/opt/riscv/bin"
```
to your .bashrc




# TODO: spike

make sure that when running spike, you set the base _start address to 0x8000_0000
this means also updating the core to have the dram be 0x8000_0000+
